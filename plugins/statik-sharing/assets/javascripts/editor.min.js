"use strict";function ownKeys(e,t){var a,r=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)),r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function asyncGeneratorStep(t,e,a,r,i,n,s){try{var o=t[n](s),l=o.value}catch(t){return void a(t)}o.done?e(l):Promise.resolve(l).then(r,i)}function _asyncToGenerator(o){return function(){var t=this,s=arguments;return new Promise(function(e,a){var r=o.apply(t,s);function i(t){asyncGeneratorStep(r,e,a,i,n,"next",t)}function n(t){asyncGeneratorStep(r,e,a,i,n,"throw",t)}i(void 0)})}}!function(c){var t;!1!==window.hasOwnProperty("statik_sharing_config")&&(window.statikApi=window.statikApi||{},statikApi.sharing={config:window.statik_sharing_config,debug:parseInt(window.statik_sharing_config.debug),$metaBoxWrapper:c(document).find("#statik_sharing_table_grid"),ajaxInProgress:0,errorModals:0,rebuildMetaBoxTimeout:null,initializeSharingActions:function(){window.hasOwnProperty("wp")&&window.hasOwnProperty("_wpLoadBlockEditor")&&window._wpLoadBlockEditor.then(function(){var a=!1,r=!1;wp.data.subscribe(function(){var t=wp.data.select("core/editor"),e=wp.data.select("core/edit-post");(a=!a&&!t.isAutosavingPost()&&t.isSavingPost()&&t.didPostSaveRequestSucceed()?!0:a)&&e.isSavingMetaBoxes()&&(r=!0),a&&r&&!e.isSavingMetaBoxes()&&(statikApi.sharing.rebuildMetaBox(0).then(function(){return statikApi.sharing.shareWaitingPosts()}),a=r=!1)})})},initializeClickActions:function(){statikApi.sharing.$metaBoxWrapper.on("change",".js-bulk-check",function(t){statikApi.sharing.$metaBoxWrapper.find('input[name="statik_share_blogs[]"]:not([disabled])').prop("checked",t.currentTarget.checked)}),statikApi.sharing.$metaBoxWrapper.on("click",".single-blog .js-action-button:not(.disabled):not(.temp-disabled)",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var a,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),clearTimeout(statikApi.sharing.rebuildMetaBoxTimeout),(a=statikApi.sharing.$metaBoxWrapper.find(".js-action-button:not(.disabled)")).addClass("temp-disabled"),r=c(e.currentTarget),i=r.closest(".single-blog"),"conflict"===r.data("warning")&&statikApi.sharing.errorModals--,t.next=9,statikApi.sharing[r.data("action")+"Blog"](i.data("blog"),i.data("post"),i).catch(function(t){return statikApi.sharing.debug&&console.error(t)});case 9:a.removeClass("temp-disabled"),statikApi.sharing.toggleBeforeUnload(!1);case 11:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()),statikApi.sharing.$metaBoxWrapper.on("click",".js-bulk-action-apply",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var a,r,i,n,s,o,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),l=c(e.currentTarget),a=l.closest(".bulk-actions").find("select").val(),l.hasClass("disabled")||l.hasClass("temp-disabled")||"function"!=typeof statikApi.sharing[a+"Blog"])return t.abrupt("return");t.next=5;break;case 5:if(r=statikApi.sharing.$metaBoxWrapper.find(".js-action-button:not(.disabled)"),i=statikApi.sharing.$metaBoxWrapper.find('input[name="statik_share_blogs[]"]:checked'),"function"!=typeof statikApi.sharing[a+"Blog"])return t.abrupt("return");t.next=9;break;case 9:clearTimeout(statikApi.sharing.rebuildMetaBoxTimeout),r.addClass("temp-disabled"),i.closest(".single-blog").addClass("in-progress"),n=0;case 13:if(n<i.length)return s=c(i[n]).closest(".single-blog"),o=s.data("blog"),l=s.data("post"),t.next=19,statikApi.sharing[a+"Blog"](o,l,s,!1).catch(function(t){return statikApi.sharing.debug&&console.error(t)});t.next=22;break;case 19:n++,t.next=13;break;case 22:if(r.removeClass("temp-disabled"),t.t0=i.length,t.t0)return t.next=27,statikApi.sharing.rebuildMetaBox();t.next=27;break;case 27:statikApi.sharing.toggleBeforeUnload(!1);case 28:case"end":return t.stop()}},t)}));return function(t){return e.apply(this,arguments)}}()),statikApi.sharing.$metaBoxWrapper.on("click",".js-close-error",function(t){t=c(t.currentTarget).closest(".single-blog");t.removeClass("is-error"),t.find(".buttons").hide(),t.removeData("post"),0==statikApi.sharing.errorModals--&&statikApi.sharing.rebuildMetaBox(0)})},shareWaitingPosts:(t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,a,r,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0===(e=statikApi.sharing.$metaBoxWrapper.find('.single-blog[data-status="statik_ajax_in_progress"]')).length)return t.abrupt("return");t.next=3;break;case 3:clearTimeout(statikApi.sharing.rebuildMetaBoxTimeout),e.addClass("in-progress"),a=!1,r=0;case 7:if(r<e.length)return i=c(e[r]).closest(".single-blog"),t.next=11,statikApi.sharing.shareBlog(i.data("blog"),i.data("post"),i,!1).catch(function(){return a=!0});t.next=14;break;case 11:r++,t.next=7;break;case 14:if(t.t0=!a&&e.length,t.t0)return t.next=18,statikApi.sharing.rebuildMetaBox();t.next=18;break;case 18:statikApi.sharing.toggleBeforeUnload(!1);case 19:case"end":return t.stop()}},t)})),function(){return t.apply(this,arguments)}),rebuildMetaBox:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1500;return new Promise(function(e,a){statikApi.sharing.rebuildMetaBoxTimeout=setTimeout(function(){statikApi.sharing.ajaxInProgress||statikApi.sharing.errorModals||c.ajax({url:ajaxurl,method:"post",data:{action:"rebuild_meta_box",post_id:c("input#post_ID").attr("value"),nonce:statikApi.sharing.$metaBoxWrapper.data("nonce")},success:function(t){statikApi.sharing.ajaxInProgress||statikApi.sharing.errorModals||(statikApi.sharing.$metaBoxWrapper.parent().html(t.success?t.data:"<p>"+t.data+"</p>"),statikApi.sharing.$metaBoxWrapper=c(document).find("#statik_sharing_table_grid"),statikApi.sharing.initializeClickActions(),e(t))},error:function(t){return a(t)}})},t)})},shareBlog:function(t,e,o){var a=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return o.addClass("in-progress"),statikApi.sharing.initializeAjaxApiRequest({action:"statik_sharing",sharing_action:"share",blog_id:parseInt(t),post_id:parseInt(e),current_post_id:parseInt(c("input#post_ID").attr("value"))},a).then(function(){o.removeClass("in-progress"),o.addClass("is-success")}).catch(function(t){var e,a,r,i,n,s;o.removeClass("in-progress"),statikApi.sharing.showRowErrorModal(o,t,!1),0!==(null==t||null===(e=t.data)||void 0===e||null===(a=e.error)||void 0===a?void 0:a.code)&&(419===(null==t||null===(r=t.data)||void 0===r||null===(i=r.error)||void 0===i?void 0:i.code)?o.find(".error-wrapper .buttons").show():o.find(".error-wrapper .buttons").hide(),o.data("post",null!==(s=JSON.parse(null==t||null===(n=t.data)||void 0===n||null===(s=n.error)||void 0===s?void 0:s.message).conflict_id)&&void 0!==s?s:""))})},deleteBlog:function(t,e,a){var r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return a.addClass("in-progress"),statikApi.sharing.initializeAjaxApiRequest({action:"statik_sharing",sharing_action:"delete",blog_id:parseInt(t),post_id:parseInt(e),current_post_id:parseInt(c("input#post_ID").attr("value"))},r).then(function(){a.removeClass("in-progress"),a.addClass("is-success")}).catch(function(t){a.removeClass("in-progress"),statikApi.sharing.showRowErrorModal(a,t)})},detachBlog:function(t,e,a){var r=!(3<arguments.length&&void 0!==arguments[3])||arguments[3];return a.addClass("in-progress"),statikApi.sharing.initializeAjaxApiRequest({action:"statik_sharing",sharing_action:"detach",blog_id:parseInt(t),post_id:parseInt(e),current_post_id:parseInt(c("input#post_ID").attr("value"))},r).then(function(){a.removeClass("in-progress"),a.addClass("is-success")}).catch(function(t){a.removeClass("in-progress"),statikApi.sharing.showRowErrorModal(a,t)})},initializeAjaxApiRequest:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},s=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return statikApi.sharing.ajaxInProgress++,new Promise(function(i,n){c.ajax({url:ajaxurl,method:"post",data:_objectSpread(_objectSpread({},t),{nonce:statikApi.sharing.$metaBoxWrapper.data("nonce")}),success:function(t){var e=t.success,a=t.data,r=a.edit_link,a=a.blog_id;statikApi.sharing.ajaxInProgress--,e?r?statikApi.sharing.createFrameWithEdit(r,a).then(function(){s&&statikApi.sharing.rebuildMetaBox(),i(t)}).catch(function(){return n(t)}):(s&&statikApi.sharing.rebuildMetaBox(),i(t)):n(t)},error:function(t){statikApi.sharing.ajaxInProgress--,n(t)}})})},createFrameWithEdit:function(t,e){var r=statikApi.sharing.$metaBoxWrapper.find('.single-blog[data-blog="'+e+'"]');return r.append(c("<iframe>").attr({id:"iframe-blog-"+e,name:"iframe-blog-"+e,src:t,sandbox:"allow-top-navigation allow-scripts allow-modals allow-same-origin"})),new Promise(function(e){var a=setInterval(function(){var t=r.find("iframe");t.hasClass("blog-ready")&&(t.remove(),clearInterval(a),e())},100)})},showRowErrorModal:function(t,e){var a,r,i;t.addClass("is-error"),statikApi.sharing.errorModals++;var n=null;try{var s,o,n=JSON.parse(null==e||null===(s=e.data)||void 0===s||null===(o=s.error)||void 0===o?void 0:o.message)}catch(t){}t.find(".error-wrapper .message").html((null===n||void 0===n?void 0:n.message)||(null==e||null===(a=e.data)||void 0===a||null===(r=a.error)||void 0===r?void 0:r.message)||(null==e||null===(i=e.data)||void 0===i?void 0:i.message)||(null==e?void 0:e.responseText)||e)},showReplicaModal:function(){var t=statikApi.sharing.config,e=t.isReplica,a=t.replica,r=t.replicaCloseWarning;return 0!==parseInt(e)&&(c(document).find("body").addClass("statik_sharing_lock_editor").append(a),c(document).on("click",".js-close-replica-modal",function(){confirm(r)&&(c("#statik_sharing_modal_wrapper").remove(),c(document).find("body").removeClass("statik_sharing_lock_editor"))}),!0)},toggleBeforeUnload:function(){window.addEventListener("beforeunload",function(t){(statikApi.sharing.ajaxInProgress||statikApi.sharing.errorModals)&&(t.preventDefault(),t.returnValue="Statik Sharing is still in progress!")})},saveReplicaPost:function(){-1!==window.location.search.indexOf("statik=update-sharing-replica")&&(statikApi.hasOwnProperty("gutenberg")&&window.hasOwnProperty("wp")&&window.hasOwnProperty("_wpLoadBlockEditor")?window._wpLoadBlockEditor.then(function(){var e=!1;wp.data.subscribe(function(){e||0===wp.data.select("core/block-editor").getBlocks().length?c(parent.document.getElementById(window.name)).addClass("blog-ready"):(e=!0,statikApi.gutenberg.saveGutenbergBlocksCallback(!0).then(function(){return c(parent.document.getElementById(window.name)).addClass("blog-ready")}).catch(function(t){(e=t.hasOwnProperty("status")&&409===t.status)&&c(parent.document.getElementById(window.name)).addClass("blog-ready"),statikApi.sharing.debug&&console.error(t)}))})}):c(parent.document.getElementById(window.name)).addClass("blog-ready"))}},statikApi.sharing.saveReplicaPost(),!1===statikApi.sharing.showReplicaModal()&&(statikApi.sharing.toggleBeforeUnload(),statikApi.sharing.initializeClickActions(),statikApi.sharing.shareWaitingPosts(),statikApi.sharing.initializeSharingActions()))}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVkaXRvci5taW4uanMiXSwibmFtZXMiOlsiJCIsIl9zaGFyZVdhaXRpbmdQb3N0cyIsIndpbmRvdyIsImhhc093blByb3BlcnR5Iiwic3RhdGlrQXBpIiwic2hhcmluZyIsImNvbmZpZyIsInN0YXRpa19zaGFyaW5nX2NvbmZpZyIsImRlYnVnIiwicGFyc2VJbnQiLCIkbWV0YUJveFdyYXBwZXIiLCJkb2N1bWVudCIsImZpbmQiLCJhamF4SW5Qcm9ncmVzcyIsImVycm9yTW9kYWxzIiwicmVidWlsZE1ldGFCb3hUaW1lb3V0IiwiaW5pdGlhbGl6ZVNoYXJpbmdBY3Rpb25zIiwiX3dwTG9hZEJsb2NrRWRpdG9yIiwidGhlbiIsInBvc3RTYXZlZCIsIndwIiwiZGF0YSIsInN1YnNjcmliZSIsImVkaXRvciIsInNlbGVjdCIsImVkaXRQb3N0IiwibWV0YVNhdmluZyIsImlzQXV0b3NhdmluZ1Bvc3QiLCJpc1NhdmluZ1Bvc3QiLCJpc1NhdmluZ01ldGFCb3hlcyIsInJlYnVpbGRNZXRhQm94IiwiaW5pdGlhbGl6ZUNsaWNrQWN0aW9ucyIsIm9uIiwiZXZlbnQiLCJjdXJyZW50VGFyZ2V0IiwiY2hlY2tlZCIsIl9yZWYiLCJfYXN5bmNUb0dlbmVyYXRvciIsInJlZ2VuZXJhdG9yUnVudGltZSIsIm1hcmsiLCJfY2FsbGVlIiwiJGFjdGlvbkJ1dHRvbnMiLCIkdGhpcyIsIiRyb3ciLCJ3cmFwIiwiX2NvbnRleHQiLCJwcmV2IiwibmV4dCIsInByZXZlbnREZWZhdWx0IiwiYWRkQ2xhc3MiLCJjbGVhclRpbWVvdXQiLCJlIiwiY29uc29sZSIsImVycm9yIiwicmVtb3ZlQ2xhc3MiLCJ0b2dnbGVCZWZvcmVVbmxvYWQiLCJzdG9wIiwiX3giLCJhcHBseSIsInRoaXMiLCJhcmd1bWVudHMiLCJfcmVmMiIsIl9jYWxsZWUyIiwic2VsZWN0VmFsdWUiLCIkYmxvZ3MiLCJpIiwiYmxvZ0lkIiwicG9zdElkIiwiX2NvbnRleHQyIiwiJGJ1dHRvbiIsImNsb3Nlc3QiLCJ2YWwiLCJoYXNDbGFzcyIsImFicnVwdCIsImxlbmd0aCIsInQwIiwiX3gyIiwiaGlkZSIsInJlbW92ZURhdGEiLCJzaGFyZVdhaXRpbmdQb3N0cyIsIl9jYWxsZWUzIiwiJHdhaXRpbmdCbG9ncyIsIl9jb250ZXh0MyIsInNoYXJlQmxvZyIsImRlbGF5IiwidW5kZWZpbmVkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJzZXRUaW1lb3V0IiwiYWpheCIsImFqYXh1cmwiLCJtZXRob2QiLCJhY3Rpb24iLCJwb3N0X2lkIiwiYXR0ciIsIm5vbmNlIiwicmVzcG9uc2UiLCJwYXJlbnQiLCJodG1sIiwic3VjY2VzcyIsInJlbG9hZCIsImluaXRpYWxpemVBamF4QXBpUmVxdWVzdCIsInNoYXJpbmdfYWN0aW9uIiwiY3VycmVudF9wb3N0X2lkIiwiX3Jlc3BvbnNlJGRhdGEiLCJfcmVzcG9uc2UkZGF0YSRlcnJvciIsIl9yZXNwb25zZSRkYXRhMiIsIl9yZXNwb25zZSRkYXRhMiRlcnJvciIsIl9yZXNwb25zZSRkYXRhMyIsIl9yZXNwb25zZSRkYXRhMyRlcnJvciIsInNob3dSb3dFcnJvck1vZGFsIiwiY29kZSIsInNob3ciLCJfSlNPTiRwYXJzZSRjb25mbGljdF8iLCJKU09OIiwicGFyc2UiLCJtZXNzYWdlIiwiY29uZmxpY3RfaWQiLCJkZWxldGVCbG9nIiwiYmxvZ19pZCIsInVybCIsIl9vYmplY3RTcHJlYWQiLCJhamF4RGF0YSIsIl9yZXNwb25zZSRkYXRhNCIsImVkaXRfbGluayIsImNyZWF0ZUZyYW1lV2l0aEVkaXQiLCJlZGl0TGluayIsImFwcGVuZCIsImlkIiwibmFtZSIsInNyYyIsInNhbmRib3giLCJpbnRlcnZhbCIsInNldEludGVydmFsIiwiJGlmcmFtZSIsImRldGFjaEJsb2ciLCJyZW1vdmUiLCJfcmVzcG9uc2UkZGF0YTYiLCJfcmVzcG9uc2UkZGF0YTYkZXJyb3IiLCJfcmVzcG9uc2UkZGF0YTciLCJfcmVzcG9uc2UkZGF0YTUiLCJfcmVzcG9uc2UkZGF0YTUkZXJyb3IiLCJzaG93UmVwbGljYU1vZGFsIiwiX3N0YXRpa0FwaSRzaGFyaW5nJGNvIiwiaXNSZXBsaWNhIiwicmVwbGljYSIsInJlcGxpY2FDbG9zZVdhcm5pbmciLCJjb25maXJtIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJldHVyblZhbHVlIiwic2F2ZVJlcGxpY2FQb3N0IiwibG9jYXRpb24iLCJzZWFyY2giLCJjbGVhckludGVydmFsIiwiZ2V0QmxvY2tzIiwiZ2V0RWxlbWVudEJ5SWQiLCJjYWxsZWQiLCJndXRlbmJlcmciLCJzYXZlR3V0ZW5iZXJnQmxvY2tzQ2FsbGJhY2siLCJzdGF0dXMiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJtbkNBQUEsU0FBV0EsR0FDVCxJQWtINENDLEdBbEh4QyxJQUFVQyxPQUFPQyxlQUFlLDJCQUlwQ0QsT0FBT0UsVUFBWUYsT0FBT0UsV0FBYSxHQUN2Q0EsVUFBVUMsUUFBVSxDQUlsQkMsT0FBUUosT0FBT0ssc0JBQ2ZDLE1BQU9DLFNBQVNQLE9BQU9LLHNCQUFzQkMsT0FLN0NFLGdCQUFpQlYsRUFBRVcsVUFBVUMsS0FBSyw4QkFQdENDLGVBQUEsRUFLQUMsWUFBQSxFQUtBQyxzQkFBQSxLQUtBQyx5QkFBQSxXQUNBZCxPQUFBQyxlQUFBLE9BQUFELE9BQUFDLGVBQUEsdUJBSUFELE9BQUFlLG1CQUFBQyxLQUFBLFdBQ0EsSUFBQUMsR0FBQSxFQUNJSixHQUFxQixFQUVyQkssR0FBQUMsS0FBQUMsVUFBQSxXQUNKLElBQUFDLEVBQUFILEdBQUFDLEtBQUFHLE9BQUEsZUFDQUMsRUFBQUwsR0FBQUMsS0FBQUcsT0FBQSxtQkFRWUUsR0FMSlAsSUFDREksRUFBQUksb0JBYVFKLEVBQU9LLGdCQVhUWCxFQUFBQSw2QkFFUyxFQUlOUSxJQUFhQSxFQUFNRCxzQkFZdkJFLEdBQWEsR0FIZFAsR0FBQU8sSUFBQUQsRUFBQUksc0JBT0N6QixVQUFVQyxRQUFReUIsZUFBZSxHQUwvQlgsS0FBQUEsV0FBQUEsT0FBU2YsVUFBYXlCLFFBQUFBLHNCQUV6QlYsRUFBQU8sR0FBQSxRQVNK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U0FBU2lKLGVBQWUxSixPQUFPZ0ksT0FBT2pGLFNBQVMsaUJBckZ6RDdDLFVBQUNDLFFBQ0RrSixtQkEwRkQsSUFBVW5KLFVBQVVDLFFBQVEwSSxxQkF4RjVCcEcsVUFBSy9CLFFBQUsyQyxxQkFPWG5ELFVBbmJpQkMsUUFBQTBCLHlCQXVnQmxCM0IsVUFBVUMsUUFBUTBFLG9CQWxGbEIzRSxVQUFBQyxRQUFBVyw2QkEzYkosQ0E2YkFpSiIsImZpbGUiOiJlZGl0b3IubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgkKSB7XG4gIGlmIChmYWxzZSA9PT0gd2luZG93Lmhhc093blByb3BlcnR5KCdzdGF0aWtfc2hhcmluZ19jb25maWcnKSkge1xuICAgIHJldHVybjsgLy9CcmVhayBsb2FkIHNjcmlwdHMgaWYgcmVxdWlyZWQgY29uZmlnIGRvZXMgbm90IGV4aXN0c1xuICB9XG5cbiAgd2luZG93LnN0YXRpa0FwaSA9IHdpbmRvdy5zdGF0aWtBcGkgfHwge307XG4gIHN0YXRpa0FwaS5zaGFyaW5nID0ge1xuICAgIC8qKlxuICAgICAqIFNoYXJpbmcgY29uZmlndXJhdGlvbi5cbiAgICAgKi9cbiAgICBjb25maWc6IHdpbmRvdy5zdGF0aWtfc2hhcmluZ19jb25maWcsXG4gICAgZGVidWc6IHBhcnNlSW50KHdpbmRvdy5zdGF0aWtfc2hhcmluZ19jb25maWcuZGVidWcpLFxuXG4gICAgLyoqXG4gICAgICogalF1ZXJ5IGVsZW1lbnRzLlxuICAgICAqL1xuICAgICRtZXRhQm94V3JhcHBlcjogJChkb2N1bWVudCkuZmluZCgnI3N0YXRpa19zaGFyaW5nX3RhYmxlX2dyaWQnKSxcblxuICAgIC8qKlxuICAgICAqIE51bWJlciBvZiBjdXJyZW50IGV4ZWN1dGluZyBBamF4IHJlcXVlc3RzLlxuICAgICAqL1xuICAgIGFqYXhJblByb2dyZXNzOiAwLFxuXG4gICAgLyoqXG4gICAgICogTnVtYmVyIG9mIGN1cnJlbnQgZGlzcGxheWVkIGVycm9ycy5cbiAgICAgKi9cbiAgICBlcnJvck1vZGFsczogMCxcblxuICAgIC8qKlxuICAgICAqIFJlYnVpbGQgTWV0YUJveCB0aW1lb3V0LlxuICAgICAqL1xuICAgIHJlYnVpbGRNZXRhQm94VGltZW91dDogbnVsbCxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgU2hhcmluZyBhY3Rpb25zLlxuICAgICAqL1xuICAgIGluaXRpYWxpemVTaGFyaW5nQWN0aW9uczogKCkgPT4ge1xuICAgICAgaWYgKCF3aW5kb3cuaGFzT3duUHJvcGVydHkoJ3dwJykgfHwgIXdpbmRvdy5oYXNPd25Qcm9wZXJ0eSgnX3dwTG9hZEJsb2NrRWRpdG9yJykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB3aW5kb3cuX3dwTG9hZEJsb2NrRWRpdG9yLnRoZW4oKCkgPT4ge1xuICAgICAgICBsZXQgcG9zdFNhdmVkID0gZmFsc2U7XG4gICAgICAgIGxldCBtZXRhU2F2aW5nID0gZmFsc2U7XG5cbiAgICAgICAgd3AuZGF0YS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGVkaXRvciA9IHdwLmRhdGEuc2VsZWN0KCdjb3JlL2VkaXRvcicpO1xuICAgICAgICAgIGNvbnN0IGVkaXRQb3N0ID0gd3AuZGF0YS5zZWxlY3QoJ2NvcmUvZWRpdC1wb3N0Jyk7XG5cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAhcG9zdFNhdmVkXG4gICAgICAgICAgICAmJiAhZWRpdG9yLmlzQXV0b3NhdmluZ1Bvc3QoKVxuICAgICAgICAgICAgJiYgZWRpdG9yLmlzU2F2aW5nUG9zdCgpXG4gICAgICAgICAgICAmJiBlZGl0b3IuZGlkUG9zdFNhdmVSZXF1ZXN0U3VjY2VlZCgpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBwb3N0U2F2ZWQgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChwb3N0U2F2ZWQgJiYgZWRpdFBvc3QuaXNTYXZpbmdNZXRhQm94ZXMoKSkge1xuICAgICAgICAgICAgbWV0YVNhdmluZyA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHBvc3RTYXZlZCAmJiBtZXRhU2F2aW5nICYmICFlZGl0UG9zdC5pc1NhdmluZ01ldGFCb3hlcygpKSB7XG4gICAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy5yZWJ1aWxkTWV0YUJveCgwKVxuICAgICAgICAgICAgICAudGhlbigoKSA9PiBzdGF0aWtBcGkuc2hhcmluZy5zaGFyZVdhaXRpbmdQb3N0cygpKTtcblxuICAgICAgICAgICAgcG9zdFNhdmVkID0gbWV0YVNhdmluZyA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIGNsaWNrIGFjdGlvbiBpbiBTaGFyaW5nIHRhYmxlLlxuICAgICAqL1xuICAgIGluaXRpYWxpemVDbGlja0FjdGlvbnM6ICgpID0+IHtcbiAgICAgIC8qIEhhbmRsZSBidWxrIGNoZWNrYm94ICovXG4gICAgICBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXJcbiAgICAgICAgLm9uKCdjaGFuZ2UnLCAnLmpzLWJ1bGstY2hlY2snLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXJcbiAgICAgICAgICAgIC5maW5kKCdpbnB1dFtuYW1lPVwic3RhdGlrX3NoYXJlX2Jsb2dzW11cIl06bm90KFtkaXNhYmxlZF0pJylcbiAgICAgICAgICAgIC5wcm9wKCdjaGVja2VkJywgZXZlbnQuY3VycmVudFRhcmdldC5jaGVja2VkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8qIEhhbmRsZSBhY3Rpb25zIGJ1dHRvbnMgZm9yIGVhY2ggYmxvZyAqL1xuICAgICAgc3RhdGlrQXBpLnNoYXJpbmcuJG1ldGFCb3hXcmFwcGVyXG4gICAgICAgIC5vbignY2xpY2snLCAnLnNpbmdsZS1ibG9nIC5qcy1hY3Rpb24tYnV0dG9uOm5vdCguZGlzYWJsZWQpOm5vdCgudGVtcC1kaXNhYmxlZCknLCBhc3luYyAoZXZlbnQpID0+IHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGNsZWFyVGltZW91dChzdGF0aWtBcGkuc2hhcmluZy5yZWJ1aWxkTWV0YUJveFRpbWVvdXQpO1xuXG4gICAgICAgICAgY29uc3QgJGFjdGlvbkJ1dHRvbnMgPSBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXJcbiAgICAgICAgICAgIC5maW5kKCcuanMtYWN0aW9uLWJ1dHRvbjpub3QoLmRpc2FibGVkKScpO1xuXG4gICAgICAgICAgJGFjdGlvbkJ1dHRvbnMuYWRkQ2xhc3MoJ3RlbXAtZGlzYWJsZWQnKTtcblxuICAgICAgICAgIGNvbnN0ICR0aGlzID0gJChldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICAgICAgICBjb25zdCAkcm93ID0gJHRoaXMuY2xvc2VzdCgnLnNpbmdsZS1ibG9nJyk7XG5cbiAgICAgICAgICBpZiAoJHRoaXMuZGF0YSgnd2FybmluZycpID09PSAnY29uZmxpY3QnKSB7XG4gICAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy5lcnJvck1vZGFscy0tO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGF3YWl0IHN0YXRpa0FwaS5zaGFyaW5nWyR0aGlzLmRhdGEoJ2FjdGlvbicpICsgJ0Jsb2cnXShcbiAgICAgICAgICAgICRyb3cuZGF0YSgnYmxvZycpLFxuICAgICAgICAgICAgJHJvdy5kYXRhKCdwb3N0JyksXG4gICAgICAgICAgICAkcm93XG4gICAgICAgICAgKVxuICAgICAgICAgICAgLmNhdGNoKChlKSA9PiBzdGF0aWtBcGkuc2hhcmluZy5kZWJ1ZyAmJiBjb25zb2xlLmVycm9yKGUpKTtcblxuICAgICAgICAgICRhY3Rpb25CdXR0b25zLnJlbW92ZUNsYXNzKCd0ZW1wLWRpc2FibGVkJyk7XG4gICAgICAgICAgc3RhdGlrQXBpLnNoYXJpbmcudG9nZ2xlQmVmb3JlVW5sb2FkKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8qIEhhbmRsZSBidWxrIGFjdGlvbiBidXR0b24gKi9cbiAgICAgIHN0YXRpa0FwaS5zaGFyaW5nLiRtZXRhQm94V3JhcHBlclxuICAgICAgICAub24oJ2NsaWNrJywgJy5qcy1idWxrLWFjdGlvbi1hcHBseScsIGFzeW5jIChldmVudCkgPT4ge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgY29uc3QgJGJ1dHRvbiA9ICQoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gICAgICAgICAgY29uc3Qgc2VsZWN0VmFsdWUgPSAkYnV0dG9uLmNsb3Nlc3QoJy5idWxrLWFjdGlvbnMnKS5maW5kKCdzZWxlY3QnKS52YWwoKTtcblxuXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgJGJ1dHRvbi5oYXNDbGFzcygnZGlzYWJsZWQnKVxuICAgICAgICAgICAgfHwgJGJ1dHRvbi5oYXNDbGFzcygndGVtcC1kaXNhYmxlZCcpXG4gICAgICAgICAgICB8fCB0eXBlb2Ygc3RhdGlrQXBpLnNoYXJpbmdbc2VsZWN0VmFsdWUgKyAnQmxvZyddICE9PSAnZnVuY3Rpb24nXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgJGFjdGlvbkJ1dHRvbnMgPSBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXIuZmluZCgnLmpzLWFjdGlvbi1idXR0b246bm90KC5kaXNhYmxlZCknKTtcbiAgICAgICAgICBjb25zdCAkYmxvZ3MgPSBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXIuZmluZCgnaW5wdXRbbmFtZT1cInN0YXRpa19zaGFyZV9ibG9nc1tdXCJdOmNoZWNrZWQnKTtcblxuICAgICAgICAgIGlmICh0eXBlb2Ygc3RhdGlrQXBpLnNoYXJpbmdbc2VsZWN0VmFsdWUgKyAnQmxvZyddICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHN0YXRpa0FwaS5zaGFyaW5nLnJlYnVpbGRNZXRhQm94VGltZW91dCk7XG4gICAgICAgICAgJGFjdGlvbkJ1dHRvbnMuYWRkQ2xhc3MoJ3RlbXAtZGlzYWJsZWQnKTtcblxuICAgICAgICAgICRibG9ncy5jbG9zZXN0KCcuc2luZ2xlLWJsb2cnKS5hZGRDbGFzcygnaW4tcHJvZ3Jlc3MnKTtcblxuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgJGJsb2dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCAkcm93ID0gJCgkYmxvZ3NbaV0pLmNsb3Nlc3QoJy5zaW5nbGUtYmxvZycpO1xuICAgICAgICAgICAgY29uc3QgYmxvZ0lkID0gJHJvdy5kYXRhKCdibG9nJyk7XG4gICAgICAgICAgICBjb25zdCBwb3N0SWQgPSAkcm93LmRhdGEoJ3Bvc3QnKTtcblxuICAgICAgICAgICAgYXdhaXQgc3RhdGlrQXBpLnNoYXJpbmdbc2VsZWN0VmFsdWUgKyAnQmxvZyddKGJsb2dJZCwgcG9zdElkLCAkcm93LCBmYWxzZSlcbiAgICAgICAgICAgICAgLmNhdGNoKChlKSA9PiBzdGF0aWtBcGkuc2hhcmluZy5kZWJ1ZyAmJiBjb25zb2xlLmVycm9yKGUpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAkYWN0aW9uQnV0dG9ucy5yZW1vdmVDbGFzcygndGVtcC1kaXNhYmxlZCcpO1xuXG4gICAgICAgICAgJGJsb2dzLmxlbmd0aCAmJiBhd2FpdCBzdGF0aWtBcGkuc2hhcmluZy5yZWJ1aWxkTWV0YUJveCgpO1xuXG4gICAgICAgICAgc3RhdGlrQXBpLnNoYXJpbmcudG9nZ2xlQmVmb3JlVW5sb2FkKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIC8qIEhhbmRsZSBtb2RhbCBjbG9zZSBidXR0b24gKi9cbiAgICAgIHN0YXRpa0FwaS5zaGFyaW5nLiRtZXRhQm94V3JhcHBlclxuICAgICAgICAub24oJ2NsaWNrJywgJy5qcy1jbG9zZS1lcnJvcicsIChldmVudCkgPT4ge1xuICAgICAgICAgIGNvbnN0ICRyb3cgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoJy5zaW5nbGUtYmxvZycpO1xuXG4gICAgICAgICAgJHJvdy5yZW1vdmVDbGFzcygnaXMtZXJyb3InKTtcbiAgICAgICAgICAkcm93LmZpbmQoJy5idXR0b25zJykuaGlkZSgpXG4gICAgICAgICAgJHJvdy5yZW1vdmVEYXRhKCdwb3N0Jyk7XG5cbiAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy5lcnJvck1vZGFscy0tID09PSAwICYmIHN0YXRpa0FwaS5zaGFyaW5nLnJlYnVpbGRNZXRhQm94KDApO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hhcmVQcm9jZXNzb3IgYWxsIHdhaXRpbmcgYmxvZ3MuXG4gICAgICovXG4gICAgc2hhcmVXYWl0aW5nUG9zdHM6IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0ICR3YWl0aW5nQmxvZ3MgPSBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXJcbiAgICAgICAgLmZpbmQoJy5zaW5nbGUtYmxvZ1tkYXRhLXN0YXR1cz1cInN0YXRpa19hamF4X2luX3Byb2dyZXNzXCJdJyk7XG5cbiAgICAgIGlmICgkd2FpdGluZ0Jsb2dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNsZWFyVGltZW91dChzdGF0aWtBcGkuc2hhcmluZy5yZWJ1aWxkTWV0YUJveFRpbWVvdXQpO1xuXG4gICAgICAkd2FpdGluZ0Jsb2dzLmFkZENsYXNzKCdpbi1wcm9ncmVzcycpO1xuXG4gICAgICBsZXQgZXJyb3IgPSBmYWxzZTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAkd2FpdGluZ0Jsb2dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0ICRyb3cgPSAkKCR3YWl0aW5nQmxvZ3NbaV0pLmNsb3Nlc3QoJy5zaW5nbGUtYmxvZycpO1xuXG4gICAgICAgIGF3YWl0IHN0YXRpa0FwaS5zaGFyaW5nLnNoYXJlQmxvZyhcbiAgICAgICAgICAkcm93LmRhdGEoJ2Jsb2cnKSxcbiAgICAgICAgICAkcm93LmRhdGEoJ3Bvc3QnKSxcbiAgICAgICAgICAkcm93LFxuICAgICAgICAgIGZhbHNlXG4gICAgICAgIClcbiAgICAgICAgICAuY2F0Y2goKCkgPT4gZXJyb3IgPSB0cnVlKTtcbiAgICAgIH1cblxuICAgICAgIWVycm9yICYmICR3YWl0aW5nQmxvZ3MubGVuZ3RoICYmIGF3YWl0IHN0YXRpa0FwaS5zaGFyaW5nLnJlYnVpbGRNZXRhQm94KCk7XG4gICAgICBzdGF0aWtBcGkuc2hhcmluZy50b2dnbGVCZWZvcmVVbmxvYWQoZmFsc2UpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZWJ1aWxkIFNoYXJpbmcgdGFibGUgbWV0YSBib3guXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGVsYXlcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx1bmtub3duPn1cbiAgICAgKi9cbiAgICByZWJ1aWxkTWV0YUJveDogKGRlbGF5ID0gMTUwMCkgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgc3RhdGlrQXBpLnNoYXJpbmcucmVidWlsZE1ldGFCb3hUaW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgaWYgKHN0YXRpa0FwaS5zaGFyaW5nLmFqYXhJblByb2dyZXNzIHx8IHN0YXRpa0FwaS5zaGFyaW5nLmVycm9yTW9kYWxzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogYWpheHVybCxcbiAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICBhY3Rpb246ICdyZWJ1aWxkX21ldGFfYm94JyxcbiAgICAgICAgICAgICAgcG9zdF9pZDogJCgnaW5wdXQjcG9zdF9JRCcpLmF0dHIoJ3ZhbHVlJyksXG4gICAgICAgICAgICAgIG5vbmNlOiBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXIuZGF0YSgnbm9uY2UnKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICBpZiAoc3RhdGlrQXBpLnNoYXJpbmcuYWpheEluUHJvZ3Jlc3MgfHwgc3RhdGlrQXBpLnNoYXJpbmcuZXJyb3JNb2RhbHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXIucGFyZW50KCkuaHRtbChcbiAgICAgICAgICAgICAgICByZXNwb25zZS5zdWNjZXNzID8gcmVzcG9uc2UuZGF0YSA6IFwiPHA+XCIgKyByZXNwb25zZS5kYXRhICsgXCI8L3A+XCJcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy4kbWV0YUJveFdyYXBwZXIgPSAkKGRvY3VtZW50KS5maW5kKCcjc3RhdGlrX3NoYXJpbmdfdGFibGVfZ3JpZCcpO1xuICAgICAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy5pbml0aWFsaXplQ2xpY2tBY3Rpb25zKCk7XG5cbiAgICAgICAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3I6IChyZXNwb25zZSkgPT4gcmVqZWN0KHJlc3BvbnNlKVxuICAgICAgICAgIH0pO1xuICAgICAgICB9LCBkZWxheSk7XG4gICAgICB9KVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTaGFyZVByb2Nlc3NvciBwb3N0IGludG8gQmxvZy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBibG9nSWRcbiAgICAgKiBAcGFyYW0gcG9zdElkXG4gICAgICogQHBhcmFtICRyb3dcbiAgICAgKiBAcGFyYW0gcmVsb2FkXG4gICAgICogQHJldHVybnMge1Byb21pc2U8dW5rbm93bj59XG4gICAgICovXG4gICAgc2hhcmVCbG9nOiAoYmxvZ0lkLCBwb3N0SWQsICRyb3csIHJlbG9hZCA9IHRydWUpID0+IHtcbiAgICAgICRyb3cuYWRkQ2xhc3MoJ2luLXByb2dyZXNzJyk7XG5cbiAgICAgIHJldHVybiBzdGF0aWtBcGkuc2hhcmluZy5pbml0aWFsaXplQWpheEFwaVJlcXVlc3Qoe1xuICAgICAgICBhY3Rpb246ICdzdGF0aWtfc2hhcmluZycsXG4gICAgICAgIHNoYXJpbmdfYWN0aW9uOiAnc2hhcmUnLFxuICAgICAgICBibG9nX2lkOiBwYXJzZUludChibG9nSWQpLFxuICAgICAgICBwb3N0X2lkOiBwYXJzZUludChwb3N0SWQpLFxuICAgICAgICBjdXJyZW50X3Bvc3RfaWQ6IHBhcnNlSW50KCQoJ2lucHV0I3Bvc3RfSUQnKS5hdHRyKCd2YWx1ZScpKVxuICAgICAgfSwgcmVsb2FkKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgJHJvdy5yZW1vdmVDbGFzcygnaW4tcHJvZ3Jlc3MnKTtcbiAgICAgICAgICAkcm93LmFkZENsYXNzKCdpcy1zdWNjZXNzJyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAkcm93LnJlbW92ZUNsYXNzKCdpbi1wcm9ncmVzcycpO1xuICAgICAgICAgIHN0YXRpa0FwaS5zaGFyaW5nLnNob3dSb3dFcnJvck1vZGFsKCRyb3csIHJlc3BvbnNlLCBmYWxzZSk7XG5cbiAgICAgICAgICBpZiAocmVzcG9uc2U/LmRhdGE/LmVycm9yPy5jb2RlICE9PSAwKSB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2U/LmRhdGE/LmVycm9yPy5jb2RlID09PSA0MTkpIHtcbiAgICAgICAgICAgICAgJHJvdy5maW5kKCcuZXJyb3Itd3JhcHBlciAuYnV0dG9ucycpLnNob3coKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICRyb3cuZmluZCgnLmVycm9yLXdyYXBwZXIgLmJ1dHRvbnMnKS5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkcm93LmRhdGEoJ3Bvc3QnLCBKU09OLnBhcnNlKHJlc3BvbnNlPy5kYXRhPy5lcnJvcj8ubWVzc2FnZSkuY29uZmxpY3RfaWQgPz8gJycpXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlIHBvc3QgZnJvbSBCbG9nLlxuICAgICAqXG4gICAgICogQHBhcmFtIGJsb2dJZFxuICAgICAqIEBwYXJhbSBwb3N0SWRcbiAgICAgKiBAcGFyYW0gJHJvd1xuICAgICAqIEBwYXJhbSByZWxvYWRcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTx1bmtub3duPn1cbiAgICAgKi9cbiAgICBkZWxldGVCbG9nOiAoYmxvZ0lkLCBwb3N0SWQsICRyb3csIHJlbG9hZCA9IHRydWUpID0+IHtcbiAgICAgICRyb3cuYWRkQ2xhc3MoJ2luLXByb2dyZXNzJyk7XG5cbiAgICAgIHJldHVybiBzdGF0aWtBcGkuc2hhcmluZy5pbml0aWFsaXplQWpheEFwaVJlcXVlc3Qoe1xuICAgICAgICBhY3Rpb246ICdzdGF0aWtfc2hhcmluZycsXG4gICAgICAgIHNoYXJpbmdfYWN0aW9uOiAnZGVsZXRlJyxcbiAgICAgICAgYmxvZ19pZDogcGFyc2VJbnQoYmxvZ0lkKSxcbiAgICAgICAgcG9zdF9pZDogcGFyc2VJbnQocG9zdElkKSxcbiAgICAgICAgY3VycmVudF9wb3N0X2lkOiBwYXJzZUludCgkKCdpbnB1dCNwb3N0X0lEJykuYXR0cigndmFsdWUnKSlcbiAgICAgIH0sIHJlbG9hZClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICRyb3cucmVtb3ZlQ2xhc3MoJ2luLXByb2dyZXNzJyk7XG4gICAgICAgICAgJHJvdy5hZGRDbGFzcygnaXMtc3VjY2VzcycpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgJHJvdy5yZW1vdmVDbGFzcygnaW4tcHJvZ3Jlc3MnKTtcbiAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy5zaG93Um93RXJyb3JNb2RhbCgkcm93LCByZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEZXRhY2ggcG9zdCBmcm9tIEJsb2cuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYmxvZ0lkXG4gICAgICogQHBhcmFtIHBvc3RJZFxuICAgICAqIEBwYXJhbSAkcm93XG4gICAgICogQHBhcmFtIHJlbG9hZFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHVua25vd24+fVxuICAgICAqL1xuICAgIGRldGFjaEJsb2c6IChibG9nSWQsIHBvc3RJZCwgJHJvdywgcmVsb2FkID0gdHJ1ZSkgPT4ge1xuICAgICAgJHJvdy5hZGRDbGFzcygnaW4tcHJvZ3Jlc3MnKTtcblxuICAgICAgcmV0dXJuIHN0YXRpa0FwaS5zaGFyaW5nLmluaXRpYWxpemVBamF4QXBpUmVxdWVzdCh7XG4gICAgICAgIGFjdGlvbjogJ3N0YXRpa19zaGFyaW5nJyxcbiAgICAgICAgc2hhcmluZ19hY3Rpb246ICdkZXRhY2gnLFxuICAgICAgICBibG9nX2lkOiBwYXJzZUludChibG9nSWQpLFxuICAgICAgICBwb3N0X2lkOiBwYXJzZUludChwb3N0SWQpLFxuICAgICAgICBjdXJyZW50X3Bvc3RfaWQ6IHBhcnNlSW50KCQoJ2lucHV0I3Bvc3RfSUQnKS5hdHRyKCd2YWx1ZScpKVxuICAgICAgfSwgcmVsb2FkKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgJHJvdy5yZW1vdmVDbGFzcygnaW4tcHJvZ3Jlc3MnKTtcbiAgICAgICAgICAkcm93LmFkZENsYXNzKCdpcy1zdWNjZXNzJyk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAkcm93LnJlbW92ZUNsYXNzKCdpbi1wcm9ncmVzcycpO1xuICAgICAgICAgIHN0YXRpa0FwaS5zaGFyaW5nLnNob3dSb3dFcnJvck1vZGFsKCRyb3csIHJlc3BvbnNlKTtcbiAgICAgICAgfSlcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogTWFrZSBhIFdvcmRQcmVzcyBBamF4IGVuZHBvaW50IGNhbGwuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWpheERhdGFcbiAgICAgKiBAcGFyYW0gcmVsb2FkXG4gICAgICogQHJldHVybnMge1Byb21pc2U8dW5rbm93bj59XG4gICAgICovXG4gICAgaW5pdGlhbGl6ZUFqYXhBcGlSZXF1ZXN0OiAoYWpheERhdGEgPSB7fSwgcmVsb2FkID0gdHJ1ZSkgPT4ge1xuICAgICAgc3RhdGlrQXBpLnNoYXJpbmcuYWpheEluUHJvZ3Jlc3MrKztcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICB1cmw6IGFqYXh1cmwsXG4gICAgICAgICAgbWV0aG9kOiAncG9zdCcsXG4gICAgICAgICAgZGF0YTogey4uLmFqYXhEYXRhLCAuLi57bm9uY2U6IHN0YXRpa0FwaS5zaGFyaW5nLiRtZXRhQm94V3JhcHBlci5kYXRhKCdub25jZScpfX0sXG4gICAgICAgICAgc3VjY2VzczogKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7c3VjY2VzcywgZGF0YToge2VkaXRfbGluaywgYmxvZ19pZH19ID0gcmVzcG9uc2U7XG4gICAgICAgICAgICBzdGF0aWtBcGkuc2hhcmluZy5hamF4SW5Qcm9ncmVzcy0tO1xuXG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICBpZiAoZWRpdF9saW5rKSB7XG4gICAgICAgICAgICAgICAgc3RhdGlrQXBpLnNoYXJpbmcuY3JlYXRlRnJhbWVXaXRoRWRpdChlZGl0X2xpbmssIGJsb2dfaWQpXG4gICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlbG9hZCAmJiBzdGF0aWtBcGkuc2hhcmluZy5yZWJ1aWxkTWV0YUJveCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiByZWplY3QocmVzcG9uc2UpKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWxvYWQgJiYgc3RhdGlrQXBpLnNoYXJpbmcucmVidWlsZE1ldGFCb3goKTtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgc3RhdGlrQXBpLnNoYXJpbmcuYWpheEluUHJvZ3Jlc3MtLTtcblxuICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIGVkaXQgaWZyYW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIGVkaXRMaW5rXG4gICAgICogQHBhcmFtIGJsb2dJZFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHVua25vd24+fVxuICAgICAqL1xuICAgIGNyZWF0ZUZyYW1lV2l0aEVkaXQ6IChlZGl0TGluaywgYmxvZ0lkKSA9PiB7XG4gICAgICBjb25zdCAkcm93ID0gc3RhdGlrQXBpLnNoYXJpbmcuJG1ldGFCb3hXcmFwcGVyXG4gICAgICAgIC5maW5kKCcuc2luZ2xlLWJsb2dbZGF0YS1ibG9nPVwiJyArIGJsb2dJZCArICdcIl0nKTtcblxuICAgICAgJHJvdy5hcHBlbmQoJCgnPGlmcmFtZT4nKS5hdHRyKHtcbiAgICAgICAgaWQ6ICdpZnJhbWUtYmxvZy0nICsgYmxvZ0lkLFxuICAgICAgICBuYW1lOiAnaWZyYW1lLWJsb2ctJyArIGJsb2dJZCxcbiAgICAgICAgc3JjOiBlZGl0TGluayxcbiAgICAgICAgc2FuZGJveDogJ2FsbG93LXRvcC1uYXZpZ2F0aW9uIGFsbG93LXNjcmlwdHMgYWxsb3ctbW9kYWxzIGFsbG93LXNhbWUtb3JpZ2luJ1xuICAgICAgfSkpO1xuXG4gICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgY29uc3QgJGlmcmFtZSA9ICRyb3cuZmluZCgnaWZyYW1lJyk7XG5cbiAgICAgICAgICBpZiAoJGlmcmFtZS5oYXNDbGFzcygnYmxvZy1yZWFkeScpKSB7XG4gICAgICAgICAgICAkaWZyYW1lLnJlbW92ZSgpO1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG5cbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIDEwMCk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hvdyBlcnJvciBtZXNzYWdlIGZvciBzaW5nbGUgcm93IGluIFNoYXJpbmcgdGFibGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gJHJvd1xuICAgICAqIEBwYXJhbSByZXNwb25zZVxuICAgICAqL1xuICAgIHNob3dSb3dFcnJvck1vZGFsOiAoJHJvdywgcmVzcG9uc2UpID0+IHtcbiAgICAgICRyb3cuYWRkQ2xhc3MoJ2lzLWVycm9yJyk7XG4gICAgICBzdGF0aWtBcGkuc2hhcmluZy5lcnJvck1vZGFscysrO1xuXG4gICAgICBsZXQgbWVzc2FnZSA9IG51bGw7XG4gICAgICB0cnkge1xuICAgICAgICBtZXNzYWdlID0gSlNPTi5wYXJzZShyZXNwb25zZT8uZGF0YT8uZXJyb3I/Lm1lc3NhZ2UpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgfVxuXG4gICAgICAkcm93LmZpbmQoJy5lcnJvci13cmFwcGVyIC5tZXNzYWdlJykuaHRtbChcbiAgICAgICAgbWVzc2FnZT8ubWVzc2FnZVxuICAgICAgICB8fCByZXNwb25zZT8uZGF0YT8uZXJyb3I/Lm1lc3NhZ2VcbiAgICAgICAgfHwgcmVzcG9uc2U/LmRhdGE/Lm1lc3NhZ2VcbiAgICAgICAgfHwgcmVzcG9uc2U/LnJlc3BvbnNlVGV4dFxuICAgICAgICB8fCByZXNwb25zZVxuICAgICAgKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2hvdyByZXBsaWNhIG1vZGFsLlxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XG4gICAgICovXG4gICAgc2hvd1JlcGxpY2FNb2RhbDogKCkgPT4ge1xuICAgICAgY29uc3Qge2lzUmVwbGljYSwgcmVwbGljYSwgcmVwbGljYUNsb3NlV2FybmluZ30gPSBzdGF0aWtBcGkuc2hhcmluZy5jb25maWc7XG5cbiAgICAgIGlmICgwID09PSBwYXJzZUludChpc1JlcGxpY2EpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgJChkb2N1bWVudCkuZmluZCgnYm9keScpLmFkZENsYXNzKCdzdGF0aWtfc2hhcmluZ19sb2NrX2VkaXRvcicpLmFwcGVuZChyZXBsaWNhKVxuXG4gICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmpzLWNsb3NlLXJlcGxpY2EtbW9kYWwnLCAoKSA9PiB7XG4gICAgICAgIGlmIChjb25maXJtKHJlcGxpY2FDbG9zZVdhcm5pbmcpKSB7XG4gICAgICAgICAgJCgnI3N0YXRpa19zaGFyaW5nX21vZGFsX3dyYXBwZXInKS5yZW1vdmUoKTtcbiAgICAgICAgICAkKGRvY3VtZW50KS5maW5kKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3N0YXRpa19zaGFyaW5nX2xvY2tfZWRpdG9yJylcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSBCZWZvcmUgdW5sb2FkIHN0YXR1cy5cbiAgICAgKi9cbiAgICB0b2dnbGVCZWZvcmVVbmxvYWQ6ICgpID0+IHtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKHN0YXRpa0FwaS5zaGFyaW5nLmFqYXhJblByb2dyZXNzIHx8IHN0YXRpa0FwaS5zaGFyaW5nLmVycm9yTW9kYWxzKSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBldmVudC5yZXR1cm5WYWx1ZSA9ICdTdGF0aWsgU2hhcmluZyBpcyBzdGlsbCBpbiBwcm9ncmVzcyEnO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2F2ZSByZXBsaWNhIHBvc3QgR3V0ZW5iZXJnIG1ldGEuXG4gICAgICpcbiAgICAgKiBAc2VlIHN0YXRpa0FwaS5ndXRlbmJlcmcuc2F2ZUd1dGVuYmVyZ0Jsb2Nrc0NhbGxiYWNrXG4gICAgICovXG4gICAgc2F2ZVJlcGxpY2FQb3N0OiAoKSA9PiB7XG4gICAgICBpZiAod2luZG93LmxvY2F0aW9uLnNlYXJjaC5pbmRleE9mKCdzdGF0aWs9dXBkYXRlLXNoYXJpbmctcmVwbGljYScpID09PSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgc3RhdGlrQXBpLmhhc093blByb3BlcnR5KCdndXRlbmJlcmcnKVxuICAgICAgICAmJiB3aW5kb3cuaGFzT3duUHJvcGVydHkoJ3dwJylcbiAgICAgICAgJiYgd2luZG93Lmhhc093blByb3BlcnR5KCdfd3BMb2FkQmxvY2tFZGl0b3InKVxuICAgICAgKSB7XG4gICAgICAgIHdpbmRvdy5fd3BMb2FkQmxvY2tFZGl0b3IudGhlbigoKSA9PiB7XG4gICAgICAgICAgbGV0IGNhbGxlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgd3AuZGF0YS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNhbGxlZCB8fCB3cC5kYXRhLnNlbGVjdCgnY29yZS9ibG9jay1lZGl0b3InKS5nZXRCbG9ja3MoKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgJChwYXJlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQod2luZG93Lm5hbWUpKS5hZGRDbGFzcygnYmxvZy1yZWFkeScpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNhbGxlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIHN0YXRpa0FwaS5ndXRlbmJlcmcuc2F2ZUd1dGVuYmVyZ0Jsb2Nrc0NhbGxiYWNrKHRydWUpXG4gICAgICAgICAgICAgIC50aGVuKCgpID0+ICQocGFyZW50LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHdpbmRvdy5uYW1lKSkuYWRkQ2xhc3MoJ2Jsb2ctcmVhZHknKSlcbiAgICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIGNhbGxlZCA9IGVycm9yLmhhc093blByb3BlcnR5KCdzdGF0dXMnKSAmJiBlcnJvci5zdGF0dXMgPT09IDQwOTtcbiAgICAgICAgICAgICAgICBjYWxsZWQgJiYgJChwYXJlbnQuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQod2luZG93Lm5hbWUpKS5hZGRDbGFzcygnYmxvZy1yZWFkeScpO1xuXG4gICAgICAgICAgICAgICAgc3RhdGlrQXBpLnNoYXJpbmcuZGVidWcgJiYgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkKHBhcmVudC5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCh3aW5kb3cubmFtZSkpLmFkZENsYXNzKCdibG9nLXJlYWR5JylcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgc3RhdGlrQXBpLnNoYXJpbmcuc2F2ZVJlcGxpY2FQb3N0KCk7XG4gIGlmIChmYWxzZSA9PT0gc3RhdGlrQXBpLnNoYXJpbmcuc2hvd1JlcGxpY2FNb2RhbCgpKSB7XG4gICAgc3RhdGlrQXBpLnNoYXJpbmcudG9nZ2xlQmVmb3JlVW5sb2FkKCk7XG4gICAgc3RhdGlrQXBpLnNoYXJpbmcuaW5pdGlhbGl6ZUNsaWNrQWN0aW9ucygpO1xuICAgIHN0YXRpa0FwaS5zaGFyaW5nLnNoYXJlV2FpdGluZ1Bvc3RzKCk7XG4gICAgc3RhdGlrQXBpLnNoYXJpbmcuaW5pdGlhbGl6ZVNoYXJpbmdBY3Rpb25zKCk7XG4gIH1cbn0pKGpRdWVyeSk7Il19
