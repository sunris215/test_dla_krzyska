"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(p){!1!==window.hasOwnProperty("statik_common_config")&&(window.statikApi=window.statikApi||{},statikApi.commons={config:window.statik_common_config,debug:parseInt(window.statik_common_config.debug),$wrapper:p(document).find("#statik"),$multipleSelects:p(document).find("#statik select[data-multiple]"),$repeaters:p(document).find("#statik .js-repeater-wrapper"),handleAsyncSelectsFields:function(){statikApi.commons.$wrapper.find("select[data-async]").each(function(e,t){var r=p(t),n=r.data("current-value"),a=r.parent();p.ajax({url:statikApi.commons.config.api.base+"config/async-select/"+r.data("async"),method:"GET",beforeSend:function(e){a.addClass("loading"),e.setRequestHeader("X-WP-Nonce",statikApi.commons.config.nonce)},error:function(e){statikApi.commons.debug&&console.log(e)},success:function(e){"object"===_typeof(e)&&e.forEach(function(e){e.value===n&&(e.selected=!0),r.append(p("<option>",e))}),r.attr("data-disabled")||r.removeAttr("disabled")},complete:function(){a.removeClass("loading")}})})},handleMultipleSelects:function(){0!==statikApi.commons.$multipleSelects.length&&(p("<link/>",{rel:"stylesheet",type:"text/css",href:statikApi.commons.config.assetsUrl+"/stylesheets/vendors/selectize-0.12.6.min.css"}).appendTo("head"),p.getScript(statikApi.commons.config.assetsUrl+"/javascripts/vendors/jquery-ui-1.12.1.min.js",function(){p.getScript(statikApi.commons.config.assetsUrl+"/javascripts/vendors/selectize-0.12.6.min.js",function(){statikApi.commons.$multipleSelects.each(function(e,t){var r=p(t).data("validation");p(t).selectize({plugins:["remove_button","drag_drop"],delimiter:",",persist:!1,mode:"multi",create:function(e){return!("string"==typeof r&&!RegExp(r).test(e))&&{value:e,text:e}}})})})}))},handleRepeaters:function(){0!==statikApi.commons.$repeaters.length&&(statikApi.commons.$repeaters.on("click",".js-add-row",function(e){e.preventDefault();var t=p(e.currentTarget).closest(".js-repeater-wrapper"),e=t.find(".js-fields-wrapper .js-repeater-row:last-of-type").data("key")||0;t.find(".js-fields-wrapper").append(t.find(".js-template").html().replace(/data-name/g,"name").replace(/data-required/g,"required").replace(/template-key/g,e+1))}),statikApi.commons.$repeaters.on("click",".js-remove-row",function(e){e.preventDefault(),p(e.currentTarget).closest(".js-repeater-row").remove()}))},handleSettingsSelect:function(){statikApi.commons.$wrapper.on("change","#nav-select",function(e){window.location.href=e.currentTarget.value})},handleConditionsFieldset:function(){function e(){var e=statikApi.commons.$wrapper.find(".statik-grid-row[data-conditions]"),l=statikApi.commons.$wrapper.find(".statik-generator[data-namespace]").data("namespace");e.each(function(e,t){for(var r=p(t),t=r.data("conditions"),n=!0,a=0,i=Object.entries(t);a<i.length;a++){var o=_slicedToArray(i[a],2),s=o[0],c=o[1],o=void 0,o="!"===s.substring(s.length-1)&&(s=s.substring(0,s.length-1),!0),s=statikApi.commons.$wrapper.find('[name="'.concat(l,"[").concat(s,']"]'));s.length&&(n=o?s.val()!==c:s.val()===c)}n?(r.css("display","grid"),r.find("input[data-required], select[data-required], textarea[data-required]").attr("required",!0)):(r.css("display","none"),r.find("input[data-required], select[data-required], textarea[data-required]").removeAttr("required"))})}statikApi.commons.$wrapper.find("input[required], select[required], textarea[required]").attr("data-required",!0),statikApi.commons.$wrapper.on("change","form",e),e()}},statikApi.commons.handleAsyncSelectsFields(),statikApi.commons.handleMultipleSelects(),statikApi.commons.handleRepeaters(),statikApi.commons.handleSettingsSelect(),statikApi.commons.handleConditionsFieldset())}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNldHRpbmdzLm1pbi5qcyJdLCJuYW1lcyI6WyIkIiwid2luZG93IiwiaGFzT3duUHJvcGVydHkiLCJzdGF0aWtBcGkiLCJjb21tb25zIiwiY29uZmlnIiwic3RhdGlrX2NvbW1vbl9jb25maWciLCJkZWJ1ZyIsInBhcnNlSW50IiwiJHdyYXBwZXIiLCJkb2N1bWVudCIsImZpbmQiLCIkbXVsdGlwbGVTZWxlY3RzIiwiJHJlcGVhdGVycyIsImhhbmRsZUFzeW5jU2VsZWN0c0ZpZWxkcyIsImVhY2giLCJpbmRleCIsImVsZW1lbnQiLCIkdGhpcyIsImN1cnJlbnRWYWx1ZSIsIiRsb2FkZXIiLCJwYXJlbnQiLCJhamF4IiwidXJsIiwiYXBpIiwiYmFzZSIsImRhdGEiLCJtZXRob2QiLCJhZGRDbGFzcyIsIm5vbmNlIiwiZXJyb3IiLCJ4aHIiLCJjb25zb2xlIiwibG9nIiwiZm9yRWFjaCIsIml0ZW0iLCJhcHBlbmQiLCJiZWZvcmVTZW5kIiwiYXR0ciIsImhhbmRsZU11bHRpcGxlU2VsZWN0cyIsImxlbmd0aCIsImNvbXBsZXRlIiwiaHJlZiIsImFzc2V0c1VybCIsImFwcGVuZFRvIiwiZ2V0U2NyaXB0IiwicmVnZXgiLCJkZWxpbWl0ZXIiLCJwZXJzaXN0IiwibW9kZSIsImNyZWF0ZSIsImlucHV0IiwiUmVnRXhwIiwidGVzdCIsImhhbmRsZVJlcGVhdGVycyIsInRleHQiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiJHJlcGVhdGVyIiwiY3VycmVudFRhcmdldCIsImNsb3Nlc3QiLCJsYXN0S2V5IiwiaHRtbCIsInJlcGxhY2UiLCJvbiIsInJlbW92ZSIsImhhbmRsZVNldHRpbmdzU2VsZWN0IiwibG9jYXRpb24iLCJ2YWx1ZSIsIiRjb25kaXRpb25hbEZpZWxkc2V0IiwibmFtZXNwYWNlIiwiaGFuZGxlQ29uZGl0aW9uc0ZpZWxkc2V0IiwiZWwiLCJoYW5kbGVyIiwiX2kiLCJfT2JqZWN0JGVudHJpZXMiLCJlbnRyaWVzIiwiX09iamVjdCRlbnRyaWVzJF9pIiwiX3NsaWNlZFRvQXJyYXkiLCJrZXkiLCIkZmllbGRzZXQiLCJyZXN1bHQiLCJuZWdhdGlvbiIsIk9iamVjdCIsInN1YnN0cmluZyIsIiRmaWVsZCIsInZhbCIsImNzcyJdLCJtYXBwaW5ncyI6Iis0Q0FBQSxTQUFXQSxJQUNMLElBQVVDLE9BQU9DLGVBQWUsMEJBSXBDRCxPQUFPRSxVQUFZRixPQUFPRSxXQUFhLEdBQ3ZDQSxVQUFVQyxRQUFVLENBSWxCQyxPQUFRSixPQUFPSyxxQkFDZkMsTUFBT0MsU0FBU1AsT0FBT0sscUJBQXFCQyxPQVgvQ0UsU0FBYVQsRUFBQVUsVUFBQUMsS0FBQSxXQUNaQyxpQkFBb0JaLEVBQUNFLFVBQUFBLEtBQWUsaUNBQ2xDVyxXQUFRYixFQUFBVSxVQUFBQyxLQUFBLGdDQUtSRyx5QkFBQSxXQUNKWCxVQUFBQyxRQUFBSyxTQUFBRSxLQUFBLHNCQUFBSSxLQUFBLFNBQUFDLEVBQUFDLEdBQ0EsSUFBQUMsRUFBQWxCLEVBQUFpQixHQUNVRSxFQUFTYixFQUFBQSxLQUFBQSxpQkFDVmMsRUFBV25CLEVBQU1vQixTQUV0QnJCLEVBQUFzQixLQUFBLENBQ0pDLElBQUFwQixVQUFBQyxRQUFBQyxPQUFBbUIsSUFBQUMsS0FBQSx1QkFBQVAsRUFBQVEsS0FBQSxTQUNBQyxPQUFBLE1BQ0lsQixXQUFZQyxTQUFBQSxHQUNaRSxFQUFnQmdCLFNBQUlsQixXQUNwQkcsRUFBWWIsaUJBQWlCLGFBQUFHLFVBQUFDLFFBWlhDLE9BQUF3QixRQWNsQkMsTUFBQSxTQUFBQyxHQUNKNUIsVUFBQUMsUUFBQUcsT0FBQXlCLFFBQUFDLElBQUFGLElBRUlqQixRQUFBQSxTQUFBQSxHQUNvQkwsV0FBbEJOLFFBQVVDLElBQXNCMkIsRUFBQUcsUUFBQSxTQUFBQyxHQUNyQkEsRUFBS2xCLFFBQWRFLElBQ0VBLEVBQUFBLFVBQXFCTyxHQUd2QlIsRUFBT2tCLE9BQUFwQyxFQUFBLFdBQUFtQyxNQUdMRSxFQUFZQyxLQUFBLGtCQUNWbEIsRUFBUVEsV0FBUyxhQUduQkUsU0FBTyxXQUNM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LFNBRVhBLEtBQUEseURBL0JIMkIsS0FBQSxpQkFBQSxHQXVDRm5DLFVBQVVDLFFBQVFLLFNBQVN1RCxHQUFHLFNBQVUsT0FBUVMsR0FKaER0RSxNQXpLZ0JBLFVBQXBCQyxRQUFBVSwyQkFrTEFYLFVBQVVDLFFBQVFVLHdCQUNsQlgsVUFBVUMsUUFBUW1DLGtCQUNsQnBDLFVBQVVDLFFBQVFrRCx1QkFDbEJuRCxVQUFVQyxRQUFROEQsNEJBM0xwQixDQTRMRS9EIiwiZmlsZSI6InNldHRpbmdzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoJCkge1xuICBpZiAoZmFsc2UgPT09IHdpbmRvdy5oYXNPd25Qcm9wZXJ0eSgnc3RhdGlrX2NvbW1vbl9jb25maWcnKSkge1xuICAgIHJldHVybjsgLy9CcmVhayBsb2FkIHNjcmlwdHMgaWYgcmVxdWlyZWQgY29uZmlnIGRvZXMgbm90IGV4aXN0c1xuICB9XG5cbiAgd2luZG93LnN0YXRpa0FwaSA9IHdpbmRvdy5zdGF0aWtBcGkgfHwge307XG4gIHN0YXRpa0FwaS5jb21tb25zID0ge1xuICAgIC8qKlxuICAgICAqIENvbW1vbnMgY29uZmlndXJhdGlvbi5cbiAgICAgKi9cbiAgICBjb25maWc6IHdpbmRvdy5zdGF0aWtfY29tbW9uX2NvbmZpZyxcbiAgICBkZWJ1ZzogcGFyc2VJbnQod2luZG93LnN0YXRpa19jb21tb25fY29uZmlnLmRlYnVnKSxcblxuICAgIC8qKlxuICAgICAqIGpRdWVyeSBlbGVtZW50cy5cbiAgICAgKi9cbiAgICAkd3JhcHBlcjogJChkb2N1bWVudCkuZmluZCgnI3N0YXRpaycpLFxuICAgICRtdWx0aXBsZVNlbGVjdHM6ICQoZG9jdW1lbnQpLmZpbmQoJyNzdGF0aWsgc2VsZWN0W2RhdGEtbXVsdGlwbGVdJyksXG4gICAgJHJlcGVhdGVyczogJChkb2N1bWVudCkuZmluZCgnI3N0YXRpayAuanMtcmVwZWF0ZXItd3JhcHBlcicpLFxuXG4gICAgLyoqXG4gICAgICogU3VwcG9ydCBmb3IgYXN5bmMgc2VsZWN0cy4gTWV0aG9kIGNhbGwgUkVTVCBBUEkgZW5kcG9pbnQgZm9yIGdldCBhbGwgYXZhaWxhYmxlIG9wdGlvbnMuXG4gICAgICovXG4gICAgaGFuZGxlQXN5bmNTZWxlY3RzRmllbGRzOiAoKSA9PiB7XG4gICAgICBzdGF0aWtBcGkuY29tbW9ucy4kd3JhcHBlci5maW5kKCdzZWxlY3RbZGF0YS1hc3luY10nKS5lYWNoKChpbmRleCwgZWxlbWVudCkgPT4ge1xuICAgICAgICBsZXQgJHRoaXMgPSAkKGVsZW1lbnQpLFxuICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9ICR0aGlzLmRhdGEoJ2N1cnJlbnQtdmFsdWUnKSxcbiAgICAgICAgICAkbG9hZGVyID0gJHRoaXMucGFyZW50KCk7XG5cbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICB1cmw6IHN0YXRpa0FwaS5jb21tb25zLmNvbmZpZy5hcGkuYmFzZSArICdjb25maWcvYXN5bmMtc2VsZWN0LycgKyAkdGhpcy5kYXRhKCdhc3luYycpLFxuICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICBiZWZvcmVTZW5kOiAoeGhyKSA9PiB7XG4gICAgICAgICAgICAkbG9hZGVyLmFkZENsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcignWC1XUC1Ob25jZScsIHN0YXRpa0FwaS5jb21tb25zLmNvbmZpZy5ub25jZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlcnJvcjogKHhocikgPT4ge1xuICAgICAgICAgICAgc3RhdGlrQXBpLmNvbW1vbnMuZGVidWcgJiYgY29uc29sZS5sb2coeGhyKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN1Y2Nlc3M6ICh4aHIpID0+IHtcbiAgICAgICAgICAgIHR5cGVvZiB4aHIgPT09ICdvYmplY3QnICYmIHhoci5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChpdGVtLnZhbHVlID09PSBjdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpdGVtWydzZWxlY3RlZCddID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAkdGhpcy5hcHBlbmQoJCgnPG9wdGlvbj4nLCBpdGVtKSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCEkdGhpcy5hdHRyKCdkYXRhLWRpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgJHRoaXMucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgICAgICAkbG9hZGVyLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTdXBwb3J0IGZvciBtdWx0aXBsZSBzZWxlY3QgZmllbGQuIEFkZCByZXF1aXJlZCB2ZW5kb3JzIGFuZCBtYW5hZ2UgZmllbGQuXG4gICAgICovXG4gICAgaGFuZGxlTXVsdGlwbGVTZWxlY3RzOiAoKSA9PiB7XG4gICAgICBpZiAoc3RhdGlrQXBpLmNvbW1vbnMuJG11bHRpcGxlU2VsZWN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAkKCc8bGluay8+Jywge1xuICAgICAgICByZWw6ICdzdHlsZXNoZWV0JyxcbiAgICAgICAgdHlwZTogJ3RleHQvY3NzJyxcbiAgICAgICAgaHJlZjogc3RhdGlrQXBpLmNvbW1vbnMuY29uZmlnLmFzc2V0c1VybCArICcvc3R5bGVzaGVldHMvdmVuZG9ycy9zZWxlY3RpemUtMC4xMi42Lm1pbi5jc3MnXG4gICAgICB9KS5hcHBlbmRUbygnaGVhZCcpO1xuXG4gICAgICAkLmdldFNjcmlwdChzdGF0aWtBcGkuY29tbW9ucy5jb25maWcuYXNzZXRzVXJsICsgJy9qYXZhc2NyaXB0cy92ZW5kb3JzL2pxdWVyeS11aS0xLjEyLjEubWluLmpzJywgKCkgPT4ge1xuICAgICAgICAkLmdldFNjcmlwdChzdGF0aWtBcGkuY29tbW9ucy5jb25maWcuYXNzZXRzVXJsICsgJy9qYXZhc2NyaXB0cy92ZW5kb3JzL3NlbGVjdGl6ZS0wLjEyLjYubWluLmpzJywgKCkgPT4ge1xuICAgICAgICAgIHN0YXRpa0FwaS5jb21tb25zLiRtdWx0aXBsZVNlbGVjdHMuZWFjaCgoaW5kZXgsIGVsZW1lbnQpID0+IHtcbiAgICAgICAgICAgIGxldCByZWdleCA9ICQoZWxlbWVudCkuZGF0YSgndmFsaWRhdGlvbicpO1xuXG4gICAgICAgICAgICAkKGVsZW1lbnQpLnNlbGVjdGl6ZSh7XG4gICAgICAgICAgICAgIHBsdWdpbnM6IFsncmVtb3ZlX2J1dHRvbicsICdkcmFnX2Ryb3AnXSxcbiAgICAgICAgICAgICAgZGVsaW1pdGVyOiAnLCcsXG4gICAgICAgICAgICAgIHBlcnNpc3Q6IGZhbHNlLFxuICAgICAgICAgICAgICBtb2RlOiAnbXVsdGknLFxuICAgICAgICAgICAgICBjcmVhdGU6IChpbnB1dCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVnZXggPT09ICdzdHJpbmcnICYmICFSZWdFeHAocmVnZXgpLnRlc3QoaW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHt2YWx1ZTogaW5wdXQsIHRleHQ6IGlucHV0fVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIHJlcGVhdGVyIGZpZWxkc2V0LlxuICAgICAqL1xuICAgIGhhbmRsZVJlcGVhdGVyczogKCkgPT4ge1xuICAgICAgaWYgKHN0YXRpa0FwaS5jb21tb25zLiRyZXBlYXRlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgc3RhdGlrQXBpLmNvbW1vbnMuJHJlcGVhdGVycy5vbignY2xpY2snLCAnLmpzLWFkZC1yb3cnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBjb25zdCAkcmVwZWF0ZXIgPSAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoJy5qcy1yZXBlYXRlci13cmFwcGVyJyk7XG4gICAgICAgIGNvbnN0IGxhc3RLZXkgPSAkcmVwZWF0ZXJcbiAgICAgICAgICAuZmluZCgnLmpzLWZpZWxkcy13cmFwcGVyIC5qcy1yZXBlYXRlci1yb3c6bGFzdC1vZi10eXBlJylcbiAgICAgICAgICAuZGF0YSgna2V5JykgfHwgMDtcblxuICAgICAgICAkcmVwZWF0ZXIuZmluZCgnLmpzLWZpZWxkcy13cmFwcGVyJykuYXBwZW5kKFxuICAgICAgICAgICRyZXBlYXRlci5maW5kKCcuanMtdGVtcGxhdGUnKS5odG1sKClcbiAgICAgICAgICAgIC5yZXBsYWNlKC9kYXRhLW5hbWUvZywgJ25hbWUnKVxuICAgICAgICAgICAgLnJlcGxhY2UoL2RhdGEtcmVxdWlyZWQvZywgJ3JlcXVpcmVkJylcbiAgICAgICAgICAgIC5yZXBsYWNlKC90ZW1wbGF0ZS1rZXkvZywgbGFzdEtleSArIDEpXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgc3RhdGlrQXBpLmNvbW1vbnMuJHJlcGVhdGVycy5vbignY2xpY2snLCAnLmpzLXJlbW92ZS1yb3cnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAkKGV2ZW50LmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoJy5qcy1yZXBlYXRlci1yb3cnKS5yZW1vdmUoKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgc2V0dGluZ3Mgc2VsZWN0XG4gICAgICovXG4gICAgaGFuZGxlU2V0dGluZ3NTZWxlY3Q6ICgpID0+IHtcbiAgICAgIHN0YXRpa0FwaS5jb21tb25zLiR3cmFwcGVyLm9uKCdjaGFuZ2UnLCAnI25hdi1zZWxlY3QnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlXG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgaGFuZGxlQ29uZGl0aW9uc0ZpZWxkc2V0OiAoKSA9PiB7XG4gICAgICBjb25zdCBoYW5kbGVyID0gKCkgPT4ge1xuICAgICAgICBjb25zdCAkY29uZGl0aW9uYWxGaWVsZHNldCA9IHN0YXRpa0FwaS5jb21tb25zLiR3cmFwcGVyLmZpbmQoJy5zdGF0aWstZ3JpZC1yb3dbZGF0YS1jb25kaXRpb25zXScpO1xuICAgICAgICBjb25zdCBuYW1lc3BhY2UgPSBzdGF0aWtBcGkuY29tbW9ucy4kd3JhcHBlci5maW5kKCcuc3RhdGlrLWdlbmVyYXRvcltkYXRhLW5hbWVzcGFjZV0nKS5kYXRhKCduYW1lc3BhY2UnKTtcblxuICAgICAgICAkY29uZGl0aW9uYWxGaWVsZHNldC5lYWNoKChpbmRleCwgZWwpID0+IHtcbiAgICAgICAgICBjb25zdCAkZmllbGRzZXQgPSAkKGVsKTtcbiAgICAgICAgICBjb25zdCBjb25maWcgPSAkZmllbGRzZXQuZGF0YSgnY29uZGl0aW9ucycpO1xuXG4gICAgICAgICAgbGV0IHJlc3VsdCA9IHRydWU7XG5cbiAgICAgICAgICBmb3IgKGxldCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY29uZmlnKSkge1xuICAgICAgICAgICAgbGV0IG5lZ2F0aW9uO1xuXG4gICAgICAgICAgICBpZiAoa2V5LnN1YnN0cmluZyhrZXkubGVuZ3RoIC0gMSkgPT09ICchJykge1xuICAgICAgICAgICAgICBrZXkgPSBrZXkuc3Vic3RyaW5nKDAsIGtleS5sZW5ndGggLSAxKVxuICAgICAgICAgICAgICBuZWdhdGlvbiA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBuZWdhdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCAkZmllbGQgPSBzdGF0aWtBcGkuY29tbW9ucy4kd3JhcHBlci5maW5kKGBbbmFtZT1cIiR7bmFtZXNwYWNlfVske2tleX1dXCJdYClcblxuICAgICAgICAgICAgaWYgKCRmaWVsZC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gbmVnYXRpb24gPyAkZmllbGQudmFsKCkgIT09IHZhbHVlIDogJGZpZWxkLnZhbCgpID09PSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAkZmllbGRzZXQuY3NzKCdkaXNwbGF5JywgJ2dyaWQnKTtcbiAgICAgICAgICAgICRmaWVsZHNldC5maW5kKCdpbnB1dFtkYXRhLXJlcXVpcmVkXSwgc2VsZWN0W2RhdGEtcmVxdWlyZWRdLCB0ZXh0YXJlYVtkYXRhLXJlcXVpcmVkXScpXG4gICAgICAgICAgICAgIC5hdHRyKCdyZXF1aXJlZCcsIHRydWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkZmllbGRzZXQuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICRmaWVsZHNldC5maW5kKCdpbnB1dFtkYXRhLXJlcXVpcmVkXSwgc2VsZWN0W2RhdGEtcmVxdWlyZWRdLCB0ZXh0YXJlYVtkYXRhLXJlcXVpcmVkXScpXG4gICAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdyZXF1aXJlZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgICAgc3RhdGlrQXBpLmNvbW1vbnMuJHdyYXBwZXJcbiAgICAgICAgLmZpbmQoJ2lucHV0W3JlcXVpcmVkXSwgc2VsZWN0W3JlcXVpcmVkXSwgdGV4dGFyZWFbcmVxdWlyZWRdJylcbiAgICAgICAgLmF0dHIoJ2RhdGEtcmVxdWlyZWQnLCB0cnVlKTtcblxuICAgICAgc3RhdGlrQXBpLmNvbW1vbnMuJHdyYXBwZXIub24oJ2NoYW5nZScsICdmb3JtJywgaGFuZGxlcilcbiAgICAgIGhhbmRsZXIoKTtcbiAgICB9XG4gIH07XG5cbiAgc3RhdGlrQXBpLmNvbW1vbnMuaGFuZGxlQXN5bmNTZWxlY3RzRmllbGRzKCk7XG4gIHN0YXRpa0FwaS5jb21tb25zLmhhbmRsZU11bHRpcGxlU2VsZWN0cygpO1xuICBzdGF0aWtBcGkuY29tbW9ucy5oYW5kbGVSZXBlYXRlcnMoKTtcbiAgc3RhdGlrQXBpLmNvbW1vbnMuaGFuZGxlU2V0dGluZ3NTZWxlY3QoKTtcbiAgc3RhdGlrQXBpLmNvbW1vbnMuaGFuZGxlQ29uZGl0aW9uc0ZpZWxkc2V0KCk7XG59KShqUXVlcnkpO1xuIl19
